// Note: most of this file was auto-generated by GitHub Copilot! :)

using Moq;
using TerevintoSoftware.StaticSiteGenerator.Services;

namespace TerevintoSoftware.StaticSiteGenerator.Tests.Services;

public class HtmlFormatterTests
{
    private readonly Mock<IUrlFormatter> _urlFormatterMock = new();

    [TestCase("<html><body><a href=\"https://localhost/\">link</a></body></html>", "<html><body><a href=\"https://localhost/\">link</a></body></html>")]
    public void FixRelativeLinks_WithoutValidLinks_ShouldReturnTheSameHtml(string inputHtml, string expectedOutputHtml)
    {
        var htmlFormatter = new HtmlFormatter(_urlFormatterMock.Object);
        
        var outputUrl = htmlFormatter.FixRelativeLinks(inputHtml, "en", "en");
        Assert.That(outputUrl, Is.EqualTo(expectedOutputHtml));
    }
    
    [TestCase("<html><body><a href=\"/Index\">link</a></body></html>", "en", "en", "<html><body><a href=\"/index.html\">link</a></body></html>")]
    [TestCase("<html><body><a href=\"/Index\">link</a></body></html>", "en", "es", "<html><body><a href=\"/es/index.html\">link</a></body></html>")]
    public void FixRelativeLinks_WithLocalLinks_ShouldReplaceTheLinksWithAppropriateCulture(string inputHtml, string defaultCulture, string currentCulture, string expectedOutputHtml)
    {
        _urlFormatterMock.Setup(x => x.Format("/Index")).Returns("/index.html");

        var htmlFormatter = new HtmlFormatter(_urlFormatterMock.Object);

        var outputUrl = htmlFormatter.FixRelativeLinks(inputHtml, defaultCulture, currentCulture);
        Assert.That(outputUrl, Is.EqualTo(expectedOutputHtml));
    }
}